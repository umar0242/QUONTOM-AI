<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quantum AI - Ultimate</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;700&family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #0099ff; --bg-deep: #050510; --glass-panel: rgba(20, 30, 48, 0.95); --glass-border: rgba(255, 255, 255, 0.1); --neon-green: #00ff9d; --neon-red: #ff2a55; --text-main: #ffffff; --text-mute: #8f9ba8; }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Poppins', sans-serif; }
        body { background-color: var(--bg-deep); color: var(--text-main); height: 100vh; overflow: hidden; background-image: radial-gradient(circle at 20% 30%, rgba(0, 153, 255, 0.15) 0%, transparent 40%), radial-gradient(circle at 80% 70%, rgba(255, 0, 128, 0.1) 0%, transparent 40%); animation: bgPulse 10s infinite alternate; }
        @keyframes bgPulse { 0% { background-size: 100% 100%; } 100% { background-size: 110% 110%; } }

        /* COMMON */
        .btn-shine { position: relative; overflow: hidden; }
        .btn-shine::after { content: ''; position: absolute; top: 0; left: -100%; width: 50%; height: 100%; background: linear-gradient(to right, transparent, rgba(255,255,255,0.3), transparent); transform: skewX(-25deg); transition: 0.5s; }
        .btn-shine:hover::after { left: 100%; }

        /* SCREENS */
        #login-overlay, #expired-screen, #admin-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 9999; display: flex; justify-content: center; align-items: center; flex-direction: column; transition: opacity 0.5s ease; }
        #expired-screen { display: none; z-index: 10000; text-align: center; }
        #admin-screen { display: none; background: #0b0f19; z-index: 20000; } 

        /* LOGIN */
        .login-card { width: 90%; max-width: 350px; background: rgba(255, 255, 255, 0.05); border: 1px solid var(--primary); padding: 30px; border-radius: 20px; text-align: center; box-shadow: 0 0 50px rgba(0, 153, 255, 0.2); backdrop-filter: blur(10px); }
        .lock-icon { font-size: 3rem; color: var(--primary); margin-bottom: 20px; }
        .login-title { font-family: 'Orbitron', sans-serif; font-size: 1.5rem; margin-bottom: 10px; letter-spacing: 2px; }

        .input-group { position: relative; width: 100%; margin-bottom: 20px; text-align: left; }
        .input-label { color: #aaa; font-size: 0.8rem; margin-bottom: 5px; display: block; margin-left: 5px; }
        .key-input { width: 100%; padding: 12px; background: #0a0f16; border: 1px solid #333; color: #fff; border-radius: 10px; text-align: center; font-size: 1rem; outline: none; transition: 0.3s; padding-right: 40px; }
        .key-input:focus { border-color: var(--primary); box-shadow: 0 0 15px rgba(0, 153, 255, 0.3); }
        .pass-wrapper { position: relative; }
        .key-input-pass { padding-right: 40px; }
        .eye-icon { position: absolute; right: 15px; top: 50%; transform: translateY(-50%); cursor: pointer; color: var(--primary); font-size: 1.2rem; opacity: 0.7; }
        .unlock-btn { width: 100%; padding: 15px; background: var(--primary); border: none; border-radius: 10px; color: white; font-weight: bold; cursor: pointer; font-family: 'Orbitron'; margin-top: 10px; }
        .error-msg { color: var(--neon-red); font-size: 0.8rem; margin-top: 15px; display: none; }

        /* ADMIN PANEL STYLES */
        .admin-container { width: 90%; max-width: 800px; height: 85vh; background: var(--glass-panel); border: 1px solid var(--primary); border-radius: 20px; display: flex; flex-direction: column; padding: 20px; overflow: hidden; box-shadow: 0 0 100px rgba(0,153,255,0.1); }
        .admin-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-bottom: 1px solid #333; padding-bottom: 10px; }
        .admin-title { font-family: 'Orbitron'; color: var(--primary); font-size: 1.5rem; }
        .admin-close { color: var(--neon-red); cursor: pointer; font-weight: bold; border: 1px solid var(--neon-red); padding: 5px 15px; border-radius: 5px; text-decoration: none; font-size: 0.8rem; }
        
        .admin-content { display: flex; gap: 20px; height: 100%; overflow: hidden; }
        .add-user-form { width: 35%; border-right: 1px solid #333; padding-right: 20px; display: flex; flex-direction: column; gap: 10px; }
        .user-list-box { width: 65%; overflow-y: auto; padding-right: 5px; }
        
        .admin-input, .admin-select { width: 100%; padding: 10px; background: #000; border: 1px solid #444; color: #fff; border-radius: 8px; outline: none; margin-bottom: 5px; }
        .admin-label { font-size: 0.75rem; color: #aaa; margin-bottom: -8px; margin-left: 5px; }
        .timer-group { display: flex; gap: 5px; }
        .admin-btn { padding: 12px; background: var(--neon-green); color: #000; font-weight: bold; border: none; border-radius: 8px; cursor: pointer; margin-top: 5px; font-family: 'Orbitron'; width: 100%; transition: 0.3s; }
        
        /* Edit Mode Color */
        .admin-btn.update-mode { background: #0099ff; color: #fff; }

        .user-item { display: flex; justify-content: space-between; align-items: center; background: rgba(255,255,255,0.03); margin-bottom: 10px; padding: 12px; border-radius: 8px; border-left: 4px solid var(--primary); transition: 0.3s; }
        .user-item:hover { background: rgba(255,255,255,0.06); }
        .u-info { font-size: 0.85rem; }
        .u-name { color: #fff; font-weight: bold; font-size: 1rem; }
        .u-key { color: var(--primary); font-family: monospace; }
        .u-status { font-size: 0.75rem; color: #aaa; margin-top: 2px; }
        
        .u-actions { display: flex; gap: 5px; flex-wrap: wrap; justify-content: flex-end; width: 140px; }
        .act-btn { padding: 5px 8px; border-radius: 5px; border: none; cursor: pointer; font-size: 0.7rem; font-weight: bold; font-family: 'Orbitron'; flex-grow: 1; text-align: center; }
        
        .btn-edit { background: rgba(0, 153, 255, 0.2); color: #0099ff; border: 1px solid #0099ff; }
        .btn-del { background: rgba(255, 42, 85, 0.2); color: var(--neon-red); border: 1px solid var(--neon-red); }
        .btn-block { background: rgba(255, 193, 7, 0.2); color: #ffc107; border: 1px solid #ffc107; }
        .btn-unblock { background: rgba(0, 255, 157, 0.2); color: var(--neon-green); border: 1px solid var(--neon-green); }

        /* DASHBOARD */
        #main-dashboard { display: none; width: 100%; height: 100%; justify-content: center; align-items: center; }
        .interface-card { width: 100%; max-width: 420px; background: var(--glass-panel); backdrop-filter: blur(25px); border: 1px solid var(--glass-border); border-radius: 30px; padding: 25px; box-shadow: 0 20px 60px rgba(0,0,0,0.6); position: relative; z-index: 10; }
        .bot-logo { display: block; width: 100px; height: 100px; margin: 0 auto 15px auto; border-radius: 50%; border: 3px solid var(--primary); box-shadow: 0 0 20px rgba(0, 153, 255, 0.6); object-fit: cover; animation: pulseLogo 3s infinite alternate; }
        @keyframes pulseLogo { 0% { box-shadow: 0 0 15px rgba(0, 153, 255, 0.4); } 100% { box-shadow: 0 0 30px rgba(0, 153, 255, 0.8); } }

        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .brand { font-family: 'Orbitron', sans-serif; font-size: 1.2rem; font-weight: 700; color: var(--primary); }
        .live-badge { font-size: 0.7rem; padding: 4px 10px; background: rgba(0, 255, 157, 0.1); color: var(--neon-green); border: 1px solid var(--neon-green); border-radius: 20px; display: flex; align-items: center; gap: 5px; }
        .blink { width: 6px; height: 6px; background: var(--neon-green); border-radius: 50%; animation: blinker 1.5s infinite; }
        @keyframes blinker { 50% { opacity: 0; } }

        .license-timer { background: rgba(0, 255, 157, 0.1); border: 1px solid var(--neon-green); color: var(--neon-green); padding: 5px 10px; border-radius: 8px; font-size: 0.75rem; font-family: 'Orbitron'; text-align: center; width: 100%; margin-bottom: 15px; font-weight: bold; }
        .time-bar { background: rgba(0,0,0,0.4); border: 1px solid var(--glass-border); border-radius: 12px; padding: 8px 12px; display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .clock-display { font-family: 'Orbitron', sans-serif; font-size: 1.2rem; font-weight: bold; color: #fff; text-shadow: 0 0 10px var(--primary); }
        .tz-select { background: transparent; border: none; color: var(--text-mute); font-size: 0.8rem; text-align: right; cursor: pointer; outline: none; width: 130px; font-weight: 600; }
        .tz-select option { background: #000; color: #fff; }
        .save-btn { background: rgba(255,255,255,0.1); border: 1px solid var(--glass-border); color: #fff; width: 30px; height: 30px; border-radius: 8px; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 1rem; transition: 0.2s; }

        .broker-tabs { display: flex; gap: 10px; overflow-x: auto; padding-bottom: 10px; margin-bottom: 15px; scrollbar-width: none; }
        .tab-btn { background: rgba(255,255,255,0.05); border: 1px solid var(--glass-border); color: var(--text-mute); padding: 8px 16px; border-radius: 12px; font-size: 0.75rem; font-weight: 600; cursor: pointer; white-space: nowrap; transition: 0.3s; }
        .tab-btn.active { background: var(--primary); color: #fff; border-color: var(--primary); box-shadow: 0 5px 15px rgba(0,0,0,0.3); }

        .controls { display: grid; grid-template-columns: 2fr 1fr; gap: 10px; margin-bottom: 25px; }
        .control-box { position: relative; }
        .label { font-size: 0.7rem; color: var(--text-mute); margin-bottom: 5px; text-transform: uppercase; }
        select.main-select { width: 100%; background: rgba(0,0,0,0.3); border: 1px solid var(--glass-border); color: #fff; padding: 12px; border-radius: 12px; font-size: 0.9rem; outline: none; appearance: none; }
        .control-box::after { content: '‚ñº'; position: absolute; right: 15px; bottom: 15px; font-size: 0.7rem; color: #aaa; pointer-events: none; }

        .signal-hud { width: 100%; height: 180px; background: radial-gradient(circle, rgba(255,255,255,0.02) 0%, transparent 70%); border: 1px solid var(--glass-border); border-radius: 20px; position: relative; display: flex; justify-content: center; align-items: center; flex-direction: column; margin-bottom: 25px; overflow: hidden; }
        .radar-scan { position: absolute; width: 100%; height: 100%; border-radius: 20px; background: conic-gradient(from 0deg, transparent 0%, transparent 80%, var(--primary) 100%); animation: radarSpin 2s linear infinite; opacity: 0; transition: opacity 0.3s; }
        @keyframes radarSpin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        .direction { font-size: 3rem; font-weight: 800; font-family: 'Orbitron', sans-serif; letter-spacing: 2px; }
        .arrow { font-size: 4rem; display: block; line-height: 0.8; margin-bottom: 5px; display: none; }
        .prob { font-size: 0.9rem; color: var(--text-mute); margin-top: 5px; }
        .CALL { color: var(--neon-green); text-shadow: 0 0 20px var(--neon-green); }
        .PUT { color: var(--neon-red); text-shadow: 0 0 20px var(--neon-red); }
        .WAIT { color: var(--text-mute); font-size: 1.5rem; letter-spacing: 4px; opacity: 0.5; }

        .analyze-btn { width: 100%; padding: 18px; background: linear-gradient(135deg, var(--primary), #0056b3); border: none; border-radius: 15px; color: white; font-size: 1.1rem; font-weight: 700; cursor: pointer; box-shadow: 0 10px 30px rgba(0, 153, 255, 0.3); transition: all 0.3s; position: relative; overflow: hidden; }
        .analyze-btn:hover { transform: translateY(-3px); }
        .terminal { margin-top: 20px; font-family: 'Courier New', monospace; font-size: 0.75rem; color: var(--primary); border-top: 1px solid var(--glass-border); padding-top: 10px; opacity: 0.8; }

        /* Mobile Responsive Admin */
        @media(max-width: 600px) {
            .admin-content { flex-direction: column; }
            .add-user-form, .user-list-box { width: 100%; border: none; }
            .add-user-form { border-bottom: 1px solid #333; padding-bottom: 20px; }
        }
    </style>
</head>
<body>

    <!-- EXPIRED SCREEN -->
    <div id="expired-screen">
        <h1 style="font-size: 4rem;">‚è≥</h1>
        <h2 style="color:var(--neon-red); font-family:'Orbitron';">ACCESS DENIED</h2>
        <p style="color:#aaa;">Your License has expired or<br>you have been Blocked.</p>
    </div>

    <!-- ADMIN PANEL SCREEN -->
    <div id="admin-screen">
        <div class="admin-container">
            <div class="admin-header">
                <div class="admin-title">‚ö° ADMIN DASHBOARD</div>
                <a href="#" onclick="closeAdmin()" class="admin-close">EXIT</a>
            </div>
            
            <div class="admin-content">
                <!-- Add User Form -->
                <div class="add-user-form">
                    <h4 id="formTitle" style="color:#fff; margin-bottom:5px;">Create New User</h4>
                    
                    <span class="admin-label">Username</span>
                    <input type="text" id="newUserName" class="admin-input" placeholder="e.g. Ali">
                    
                    <span class="admin-label">License Key</span>
                    <input type="text" id="newUserKey" class="admin-input" placeholder="e.g. 12345">
                    
                    <span class="admin-label">Timer Duration</span>
                    <div class="timer-group">
                        <input type="number" id="newUserDuration" class="admin-input" placeholder="30" value="30" style="flex:1;">
                        <select id="newUserUnit" class="admin-select" style="flex:1;">
                            <option value="seconds">Secs</option>
                            <option value="minutes">Mins</option>
                            <option value="hours">Hours</option>
                            <option value="days" selected>Days</option>
                            <option value="years">Years</option>
                        </select>
                    </div>
                    
                    <button id="adminSubmitBtn" class="admin-btn btn-shine" onclick="handleUserSubmit()">ADD USER</button>
                    <button id="cancelEditBtn" class="admin-btn" onclick="resetForm()" style="background:#444; color:#aaa; display:none;">CANCEL</button>
                    
                    <div id="adminMsg" style="font-size:0.8rem; color:var(--neon-green); text-align:center; margin-top:5px; height:20px;"></div>
                </div>

                <!-- User List -->
                <div class="user-list-box">
                    <h4 style="color:#fff; margin-bottom:10px;">User Management</h4>
                    <div id="userListContainer">
                        <!-- Users will be loaded here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- LOGIN SCREEN -->
    <div id="login-overlay">
        <div class="login-card">
            <div class="lock-icon">üîí</div>
            <div class="login-title">SECURE LOGIN</div>
            
            <div class="input-group">
                <span class="input-label">Username</span>
                <input type="text" id="usernameInput" class="key-input" placeholder="Enter Name">
            </div>

            <div class="input-group">
                <span class="input-label">License Key</span>
                <div class="pass-wrapper">
                    <input type="password" id="licenseKey" class="key-input key-input-pass" placeholder="Enter Key">
                    <span class="eye-icon" onclick="togglePassword()">üëÅÔ∏è</span>
                </div>
            </div>

            <button class="unlock-btn btn-shine" onclick="checkLicense()">LOGIN</button>
            <div class="error-msg" id="loginError">‚ö†Ô∏è Invalid Name or Key</div>
        </div>
    </div>

    <!-- MAIN DASHBOARD -->
    <div id="main-dashboard">
        <div class="interface-card">
            <img src="https://i.ibb.co/h1CRVZwH/Quantum-AI-in-futuristic-trading-world.png" alt="Quantum Logo" class="bot-logo">
            
            <div class="header">
                <div class="brand">QUANTUM AI</div>
                <div class="live-badge"><div class="blink"></div> GEMINI CONNECTED</div>
            </div>

            <div style="text-align:center; font-size:0.8rem; color:#aaa; margin-bottom:5px;">Welcome, <span id="displayUser" style="color:var(--primary); font-weight:bold;">User</span></div>
            <div id="licenseTimer" class="license-timer">Loading Timer...</div>

            <div class="time-bar">
                <div class="clock-display" id="clock">Loading...</div>
                <div class="tz-container">
                    <select id="tzSelector" class="tz-select" onchange="saveTimezone()"></select>
                    <button class="save-btn" onclick="saveTimezone()" title="Save Preference">üíæ</button>
                </div>
            </div>

            <div class="broker-tabs">
                <button class="tab-btn active" onclick="setTheme('quotex', '#0099ff')">QUOTEX</button>
                <button class="tab-btn" onclick="setTheme('pocket', '#00ff9d')">POCKET</button>
                <button class="tab-btn" onclick="setTheme('binomo', '#ffc107')">BINOMO</button>
                <button class="tab-btn" onclick="setTheme('iq', '#ff7600')">IQ OPTION</button>
            </div>

            <div class="controls">
                <div class="control-box">
                    <div class="label">Asset</div>
                    <select id="assetList" class="main-select">
                        <option disabled selected>Loading...</option>
                    </select>
                </div>
                <div class="control-box">
                    <div class="label">Expiry</div>
                    <select id="timeframe" class="main-select">
                        <option value="1M">1 MIN</option>
                        <option value="2M">2 MIN</option>
                        <option value="5M">5 MIN</option>
                        <option value="15M">15 MIN</option>
                    </select>
                </div>
            </div>

            <div class="signal-hud">
                <div class="radar-scan" id="radar"></div>
                <div class="signal-content">
                    <div id="sigIcon" class="arrow"></div>
                    <div id="sigText" class="direction WAIT" style="color:#555;">READY</div>
                    <div id="sigProb" class="prob">System Idle</div>
                </div>
            </div>

            <button class="analyze-btn btn-shine" id="btn" onclick="runAnalysis()">INITIATE SCAN</button>

            <div class="terminal" id="logs">> Waiting for user input...</div>
        </div>
    </div>

    <!-- MAIN SCRIPT -->
    <script type="module">
        // --- API CONFIG ---
        const RAPID_API_KEY = "dedc651b39msh260d704b56c2a5cp108d41jsn27a3b50b99bf";
        const RAPID_API_HOST = "gemini-3-pro-chat-api.p.rapidapi.com";
        const RAPID_API_URL = "https://gemini-3-pro-chat-api.p.rapidapi.com/chat/completions";

        // --- GLOBAL VARIABLES ---
        let currentUser = null;
        let countdownInterval;
        let clockInterval;
        let editingUserKey = null; // Stores key of user being edited

        // --- 0. ADMIN LOGIC (ROBUST) ---
        window.onload = function() {
            checkAdminUrl();
        };

        function checkAdminUrl() {
            const url = window.location.href;
            if (url.includes("?admin") || url.includes("#admin")) {
                openAdminPanel();
            }
        }

        window.openAdminPanel = function() {
            document.getElementById('login-overlay').style.display = 'none';
            document.getElementById('admin-screen').style.display = 'flex';
            renderUserList();
        }

        window.closeAdmin = function() {
            document.getElementById('admin-screen').style.display = 'none';
            document.getElementById('login-overlay').style.display = 'flex';
            resetForm(); // Clean up on exit
            const cleanUrl = window.location.href.split('?')[0].split('#')[0];
            window.history.replaceState({}, document.title, cleanUrl);
        };

        // Handles both Create and Update
        window.handleUserSubmit = function() {
            const name = document.getElementById('newUserName').value.trim();
            const key = document.getElementById('newUserKey').value.trim();
            const duration = parseInt(document.getElementById('newUserDuration').value);
            const unit = document.getElementById('newUserUnit').value;
            const msg = document.getElementById('adminMsg');

            if(!name || !key || isNaN(duration)) {
                msg.style.color = "red"; msg.innerText = "Check All Fields!"; return;
            }

            let users = JSON.parse(localStorage.getItem('quantum_users_db')) || [];

            // Calculate milliseconds based on unit
            let multiplier = 1000; // Seconds
            if(unit === "minutes") multiplier = 60 * 1000;
            else if(unit === "hours") multiplier = 60 * 60 * 1000;
            else if(unit === "days") multiplier = 24 * 60 * 60 * 1000;
            else if(unit === "years") multiplier = 365 * 24 * 60 * 60 * 1000;

            const expiryTime = Date.now() + (duration * multiplier);

            if(editingUserKey) {
                // --- UPDATE MODE ---
                const index = users.findIndex(u => u.key === editingUserKey);
                if(index !== -1) {
                    // If key changed, check if new key exists (but ignore self)
                    if(key !== editingUserKey && users.find(u => u.key === key)) {
                        msg.style.color = "orange"; msg.innerText = "New Key exists!"; return;
                    }
                    
                    users[index].name = name;
                    users[index].key = key;
                    users[index].expiry = expiryTime; // Reset time to new duration
                    // Block status remains what it was
                    
                    msg.style.color = "#0099ff"; msg.innerText = "User Updated!";
                }
            } else {
                // --- CREATE MODE ---
                if(users.find(u => u.key === key)) {
                    msg.style.color = "orange"; msg.innerText = "Key already exists!"; return;
                }
                users.push({ name, key, expiry: expiryTime, blocked: false });
                msg.style.color = "var(--neon-green)"; msg.innerText = "User Added!";
            }

            localStorage.setItem('quantum_users_db', JSON.stringify(users));
            renderUserList();
            resetForm();
            setTimeout(() => msg.innerText = "", 2000);
        };

        window.prepareEdit = function(key) {
            let users = JSON.parse(localStorage.getItem('quantum_users_db')) || [];
            let user = users.find(u => u.key === key);
            if(!user) return;

            // Enter Edit Mode
            editingUserKey = user.key;
            
            document.getElementById('newUserName').value = user.name;
            document.getElementById('newUserKey').value = user.key;
            // Defaulting duration to 30 days for edit, user can change
            document.getElementById('newUserDuration').value = 30; 
            document.getElementById('newUserUnit').value = 'days';

            // UI Changes
            document.getElementById('formTitle').innerText = "Edit User";
            document.getElementById('formTitle').style.color = "#0099ff";
            
            const btn = document.getElementById('adminSubmitBtn');
            btn.innerText = "UPDATE USER";
            btn.classList.add('update-mode');
            
            document.getElementById('cancelEditBtn').style.display = "block";
        };

        window.resetForm = function() {
            editingUserKey = null;
            document.getElementById('newUserName').value = "";
            document.getElementById('newUserKey').value = "";
            document.getElementById('newUserDuration').value = "30";
            document.getElementById('newUserUnit').value = "days";
            
            document.getElementById('formTitle').innerText = "Create New User";
            document.getElementById('formTitle').style.color = "#fff";
            
            const btn = document.getElementById('adminSubmitBtn');
            btn.innerText = "ADD USER";
            btn.classList.remove('update-mode');
            
            document.getElementById('cancelEditBtn').style.display = "none";
            document.getElementById('adminMsg').innerText = "";
        };

        window.deleteUser = function(key) {
            if(!confirm("Delete this user?")) return;
            let users = JSON.parse(localStorage.getItem('quantum_users_db')) || [];
            users = users.filter(u => u.key !== key);
            localStorage.setItem('quantum_users_db', JSON.stringify(users));
            renderUserList();
            if(editingUserKey === key) resetForm(); // Reset if deleting edited user
        };

        window.toggleBlock = function(key) {
            let users = JSON.parse(localStorage.getItem('quantum_users_db')) || [];
            let u = users.find(u => u.key === key);
            if(u) {
                u.blocked = !u.blocked;
                localStorage.setItem('quantum_users_db', JSON.stringify(users));
                renderUserList(); 
            }
        };

        function renderUserList() {
            const container = document.getElementById('userListContainer');
            const users = JSON.parse(localStorage.getItem('quantum_users_db')) || [];
            container.innerHTML = "";

            if(users.length === 0) {
                container.innerHTML = "<div style='color:#555; text-align:center; margin-top:20px;'>No users database</div>";
                return;
            }

            users.forEach(u => {
                const now = Date.now();
                const isExpired = now > u.expiry;
                
                // Smart Time Left Display
                const diff = u.expiry - now;
                let timeLeftStr = "";
                if(diff <= 0) {
                    timeLeftStr = "Expired";
                } else if(diff < 60000) {
                    timeLeftStr = Math.ceil(diff/1000) + " Secs";
                } else if(diff < 3600000) {
                    timeLeftStr = Math.ceil(diff/60000) + " Mins";
                } else if(diff < 86400000) {
                    timeLeftStr = Math.ceil(diff/3600000) + " Hours";
                } else {
                    timeLeftStr = Math.ceil(diff/86400000) + " Days";
                }
                
                let borderColor = '#00ff9d'; // Active
                let statusText = timeLeftStr;
                
                if(u.blocked) { 
                    borderColor = 'red'; 
                    statusText = "‚õî BLOCKED"; 
                } else if(isExpired) { 
                    borderColor = 'orange'; 
                    statusText = "‚ö†Ô∏è EXPIRED"; 
                }
                
                const blockBtnClass = u.blocked ? 'btn-unblock' : 'btn-block';
                const blockBtnText = u.blocked ? 'UNBLOCK' : 'BLOCK';

                const html = `
                <div class="user-item" style="border-left-color: ${borderColor}">
                    <div class="u-info">
                        <div class="u-name">${u.name}</div>
                        <div class="u-key">Key: ${u.key}</div>
                        <div class="u-status" style="color:${borderColor}">${statusText}</div>
                    </div>
                    <div class="u-actions">
                        <button class="act-btn btn-edit" onclick="prepareEdit('${u.key}')">EDIT</button>
                        <button class="act-btn ${blockBtnClass}" onclick="toggleBlock('${u.key}')">${blockBtnText}</button>
                        <button class="act-btn btn-del" onclick="deleteUser('${u.key}')">DEL</button>
                    </div>
                </div>`;
                container.innerHTML += html;
            });
        }

        // --- 1. LOGIN LOGIC ---
        window.togglePassword = function() {
            const x = document.getElementById("licenseKey");
            x.type = (x.type === "password") ? "text" : "password";
        };

        window.checkLicense = function() {
            const nameIn = document.getElementById('usernameInput').value.trim();
            const keyIn = document.getElementById('licenseKey').value.trim();
            
            // 1. CHECK ADMIN DB
            const users = JSON.parse(localStorage.getItem('quantum_users_db')) || [];
            let foundUser = users.find(u => u.key === keyIn && u.name.toLowerCase() === nameIn.toLowerCase());

            // 2. CHECK MASTER LOGIN (Farooq + 123123)
            if (!foundUser && nameIn.toUpperCase() === "FAROOQ" && keyIn === "123123") {
                foundUser = { 
                    name: "Farooq", 
                    key: "123123", 
                    expiry: Date.now() + (365 * 24 * 60 * 60 * 1000), 
                    blocked: false 
                };
            }

            if(foundUser) {
                currentUser = foundUser;
                const now = Date.now();
                
                // Block/Expiry Check (Master key is immune)
                if (foundUser.key !== "123123") {
                    if (foundUser.blocked) {
                         alert("This account is BLOCKED by Admin.");
                         return;
                    }
                    if (now > foundUser.expiry) {
                        document.getElementById('expired-screen').style.display = 'flex';
                        document.getElementById('login-overlay').style.display = 'none';
                        return;
                    }
                }

                document.getElementById('login-overlay').style.opacity = '0';
                document.getElementById('displayUser').innerText = foundUser.name;
                
                document.getElementById('login-overlay').style.display = 'none';
                document.getElementById('main-dashboard').style.display = 'flex'; 
                
                initBot();
                startLicenseTimer();
                
            } else {
                document.getElementById('loginError').style.display = 'block';
            }
        };

        // --- 2. TIMER LOGIC ---
        function startLicenseTimer() {
            if(!currentUser) return;
            if(countdownInterval) clearInterval(countdownInterval);

            function updateTimer() {
                // If Farooq (Master), ignore checks
                if (currentUser.key === "123123") { 
                    // Master stays active
                } else {
                    try {
                        const users = JSON.parse(localStorage.getItem('quantum_users_db')) || [];
                        const updatedUser = users.find(u => u.key === currentUser.key);
                        
                        // Security Check: If user deleted or blocked while active
                        if (!updatedUser || updatedUser.blocked) { 
                            alert("Session Terminated: Blocked or Deleted.");
                            location.reload(); 
                            return; 
                        }
                        currentUser = updatedUser;
                    } catch (e) { console.log("DB Read Error"); }
                }

                const now = Date.now();
                const distance = currentUser.expiry - now;
                
                if (distance < 0 && currentUser.key !== "123123") {
                    clearInterval(countdownInterval);
                    document.getElementById('expired-screen').style.display = 'flex';
                    document.getElementById('main-dashboard').style.display = 'none';
                } else {
                    const days = Math.floor(distance / (1000 * 60 * 60 * 24));
                    const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                    const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                    const seconds = Math.floor((distance % (1000 * 60)) / 1000);
                    document.getElementById("licenseTimer").innerHTML = `‚è≥ TIME LEFT: ${days}d ${hours}h ${minutes}m ${seconds}s`;
                }
            }
            updateTimer();
            countdownInterval = setInterval(updateTimer, 1000);
        }

        // --- 3. ALL DATA LISTS & CLOCK ---
        const timeZones = [
            { val: -12, lbl: "UTC -12" }, { val: -11, lbl: "UTC -11" }, { val: -10, lbl: "UTC -10" },
            { val: -9, lbl: "UTC -09" }, { val: -8, lbl: "UTC -08" }, { val: -7, lbl: "UTC -07" },
            { val: -6, lbl: "UTC -06" }, { val: -5, lbl: "UTC -05" }, { val: -4.5, lbl: "UTC -04:30" }, 
            { val: -4, lbl: "UTC -04" }, { val: -3.5, lbl: "UTC -03:30" }, { val: -3, lbl: "UTC -03" }, 
            { val: 0, lbl: "UTC +00" }, { val: 1, lbl: "UTC +01" }, { val: 2, lbl: "UTC +02" }, 
            { val: 3, lbl: "UTC +03" }, { val: 3.5, lbl: "UTC +03:30" }, { val: 4, lbl: "UTC +04" }, 
            { val: 4.5, lbl: "UTC +04:30" }, { val: 5, lbl: "UTC +05" }, { val: 5.5, lbl: "UTC +05:30 (IST)" }, 
            { val: 5.75, lbl: "UTC +05:45 (Nepal)" }, { val: 6, lbl: "UTC +06" }, { val: 6.5, lbl: "UTC +06:30" }, 
            { val: 7, lbl: "UTC +07" }, { val: 8, lbl: "UTC +08" }, { val: 9, lbl: "UTC +09" }, 
            { val: 9.5, lbl: "UTC +09:30" }, { val: 10, lbl: "UTC +10" }, { val: 11, lbl: "UTC +11" }, { val: 12, lbl: "UTC +12" }
        ];

        const pairs = [
            "USD/BDT (OTC)", "USD/MXN (OTC)", "USD/BRL (OTC)", "USD/IDR (OTC)", "NZD/CAD (OTC)", "NZD/CHF (OTC)", 
            "USD/NGN (OTC)", "EUR/SGD (OTC)", "USD/INR (OTC)", "USD/DZD (OTC)", "USD/EGP (OTC)", "USD/TRY (OTC)", 
            "USD/COP (OTC)", "NZD/JPY (OTC)", "CAD/CHF (OTC)", "NZD/USD (OTC)", "USD/PHP (OTC)", "USD/PKR (OTC)", 
            "EUR/NZD (OTC)", "AUD/NZD (OTC)", "GBP/NZD (OTC)", "USD/ZAR (OTC)", "EUR/JPY", "EUR/GBP", "CAD/JPY", 
            "GBP/JPY", "AUD/JPY", "USD/JPY", "EUR/USD", "GBP/USD", "AUD/CAD", "AUD/USD", "EUR/CHF", "EUR/AUD", 
            "EUR/CAD", "GBP/AUD", "GBP/CAD", "USD/CHF", "AUD/CHF", "GBP/CHF", "CHF/JPY", "USD/CAD"
        ];

        window.initBot = function() {
            const tzSelect = document.getElementById('tzSelector');
            tzSelect.innerHTML = "";
            timeZones.forEach(z => {
                const opt = document.createElement('option'); opt.value = z.val; opt.innerText = z.lbl; tzSelect.appendChild(opt);
            });
            
            const savedTZ = localStorage.getItem('quantum_tz');
            if(savedTZ) tzSelect.value = savedTZ; else tzSelect.value = 5;

            const list = document.getElementById('assetList');
            list.innerHTML = "";
            pairs.forEach(p => {
                const opt = document.createElement('option'); opt.value = p; opt.innerText = p; list.appendChild(opt);
            });

            if(clockInterval) clearInterval(clockInterval);
            
            function updateClock() {
                try {
                    const el = document.getElementById('tzSelector');
                    const offset = el && el.value ? parseFloat(el.value) : 5; 
                    const now = new Date();
                    const utc = now.getTime() + (now.getTimezoneOffset() * 60000);
                    const newDate = new Date(utc + (offset * 3600000));
                    document.getElementById('clock').innerText = newDate.toLocaleTimeString();
                } catch (e) {
                    document.getElementById('clock').innerText = "Time Error";
                }
            }
            updateClock();
            clockInterval = setInterval(updateClock, 1000);
        };

        window.saveTimezone = function() {
            localStorage.setItem('quantum_tz', document.getElementById('tzSelector').value);
            const btn = document.querySelector('.save-btn'); btn.innerHTML = "‚úÖ"; setTimeout(() => btn.innerHTML = "üíæ", 1000);
        };

        window.setTheme = function(platform, color) {
            document.documentElement.style.setProperty('--primary', color);
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            event.target.classList.add('active');
        };

        window.runAnalysis = async function() {
            const btn = document.getElementById('btn');
            const asset = document.getElementById('assetList').value;
            if(!asset) return;

            btn.disabled = true; btn.innerHTML = "GEMINI ANALYZING...";
            document.getElementById('radar').style.opacity = '1';
            document.getElementById('sigText').innerText = ""; 
            document.getElementById('sigIcon').style.display = "none"; 
            document.getElementById('sigProb').innerText = "Processing Data...";

            try {
                const response = await fetch(RAPID_API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json', 'x-rapidapi-host': RAPID_API_HOST, 'x-rapidapi-key': RAPID_API_KEY },
                    body: JSON.stringify({
                        messages: [
                            { role: "system", content: "You are a professional binary options trader." },
                            { role: "user", content: `Analyze the ${asset} pair volatility. Return JSON ONLY: {"signal": "CALL" or "PUT", "confidence": "88-98"}.` }
                        ],
                        temperature: 0.7
                    })
                });
                
                if(!response.ok) throw new Error("API Limit");
                const data = await response.json();
                
                let content = "";
                if(data.choices && data.choices[0] && data.choices[0].message) { content = data.choices[0].message.content; }
                else { content = JSON.stringify(data); }

                let cleanJson = content.replace(/```json/g, '').replace(/```/g, '').trim();
                let signal = "CALL", conf = 90;

                try {
                    const parsed = JSON.parse(cleanJson);
                    signal = parsed.signal.toUpperCase();
                    conf = parsed.confidence;
                } catch(err) {
                    signal = cleanJson.toUpperCase().includes("PUT") ? "PUT" : "CALL";
                }

                finalize(signal, conf);

            } catch(e) {
                await new Promise(r => setTimeout(r, 1500));
                finalize(Math.random() > 0.5 ? "CALL" : "PUT", Math.floor(Math.random() * (98 - 89) + 89));
            }
        };

        function finalize(res, conf) {
            document.getElementById('radar').style.opacity = '0';
            const text = document.getElementById('sigText');
            text.innerText = res; text.className = `direction ${res}`;
            
            const icon = document.getElementById('sigIcon');
            icon.style.display = "block"; 
            icon.innerText = res === "CALL" ? "‚ñ≤" : "‚ñº";
            icon.style.color = res === "CALL" ? "var(--neon-green)" : "var(--neon-red)";
            
            document.getElementById('sigProb').innerHTML = `Confidence: <b style="color:#fff">${conf}%</b>`;
            
            const btn = document.getElementById('btn');
            btn.disabled = false; btn.innerHTML = "INITIATE SCAN";
        }
    </script>
</body>
</html>